<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="Content-Language" content="zh-CN"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no">
    <meta content="yes" name="apple-mobile-web-app-capable">
    <meta content="yes" name="apple-touch-fullscreen">
    <meta content="telephone=no,email=no" name="format-detection">
    <title>购票</title>
    <script type="text/javascript" src="../js/auto-size.js"></script>
    <link href="../css/main.css" type="text/css" rel="stylesheet">
    <link href="../css/tickets-css.css" type="text/css" rel="stylesheet">
</head>
<body>
    <div class="main">
        <div class="of-scroll">
            <div class="tickets-head">
                <div class="tickets-head-time">01月10日 09:00 出发</div>
                <div class="tickets-head-address bottom-border">
                    <span>石羊场汽车站</span>
                    <img src="../img/icon_yellow_right_arrow.png" />
                    <span>德阳市人民政务中心</span>
                </div>
                <div class="tickets-head-info">
                    <span class="tickets-head-info-refund">退票</span>
                    <span class="tickets-head-info-refund-tip">发车前120分钟可在线退票</span>
                    <span class="tickets-head-info-detail">详情</span>
                </div>
            </div>
            <div class="tickets-content">
                <div class="tickets-content-id">
                    <ul id="passenger-list">
                        <li class="tickets-content-id-list bottom-border">
                            <span class="type">成人票</span>
                            <span class="name">李四</span>
                            <span class="id-number">身份证 500***********1111</span>
                            <img src="../img/icon_black_remove.png"/>
                        </li>
                    </ul>
                    <div class="tickets-content-add-id">
                        + 添加乘客（成人、儿童）
                    </div>
                </div>
                <div class="tickets-content-msg">
                    <div class="tickets-content-row bottom-border">
                        <span class="tip">手机号：</span>
                        <input id="phone" type="number" value="" placeholder="乘车人的联系方式"/>
                    </div>
                    <div class="tickets-content-row">
                        <span class="tip">行程备注：</span>
                        <input id="note-info" type="text" value="" placeholder="备注信息"/>
                    </div>
                </div>
            </div>
        </div>
        <p class="tickets-agreement">购票表示已阅读并同意<a>《客运大巴车购票、售票协议》</a></p>
        <div class="tickets-btn">
            预订购票
        </div>
    </div>
</body>
<script type="text/template" charset="utf-8" id='template_passenger'>
    {{ if (it && it.length > 0){ }}
    {{ for (var i = 0; i < it.length; i++){ }}
    <li class="tickets-content-id-list bottom-border">
        <span class="type">{{=it[i].type}}</span>
        <span class="name">{{=it[i].name}}</span>
        <span class="id-number">身份证{{=it[i].idNumber}}</span>
        <img src="../img/icon_black_remove.png" onclick="remove('{{=i}}')"/>
    </li>
    {{ } }}
    {{ } }}
</script>
<script type="text/javascript" src="../js/jquery-1.8.1.min.js"></script>
<script type="text/javascript" src="../js/exif.js"></script>
<script type="text/javascript" src="../js/get_params.js"></script>
<script type="text/javascript" src="../js/doT.js"></script>
<script type="text/javascript" src="../js/my-loading-alert-js.js"></script>
<script type="text/javascript" src="../js/main.js"></script>
<script type="text/javascript" src="../js/my-toast-alert-js.js"></script>
<script type="text/javascript">
    var select_passenger_list;
//    var obj=[{type: '成人票', name:'张三', idNumber:'500230451515151515'},
//        {type: '成人票', name:'李四', idNumber:'560254505556234592'},
//        {type: '儿童票', name:'小米', idNumber:'142566598992646266'}];
    $(function () {
//        getRequest(getParams);
//        loadAlertShow("等到中...");
        localStorage.removeItem("tickets-info");

        //添加乘客
        $(".tickets-content-add-id").bind("click",function(){
            location.href = './selectPassenger.html';
        });

        //预订购票
        $(".tickets-btn").bind("click",function(){
            var phone = $("#phone").val();
            var noteInfo = $("#note-info").val();
            if (select_passenger_list == null || select_passenger_list.length < 1) {
                toastAlertShow("请至少添加一位乘客");
                return;
            }
            if (phone == "") {
                toastAlertShow("请输入联系电话");
                return;
            }
            var ticketsInfo = [
                {passenger_list: select_passenger_list},
                {phone: phone},
                {noteInfo: noteInfo}
            ];
            localStorage.setItem("tickets-info", JSON.stringify(ticketsInfo));
            location.href = './ticketDetails.html';
        });

        //详情
        $(".tickets-head-info-detail").bind("click",function(){
            location.href = './refundInstructions.html';
        });

        //渲染选择的乘客列表
        var template=document.getElementById('template_passenger').innerHTML;
        select_passenger_list = localStorage.getItem("select_passenger_list");
        console.log("select_passenger_list + " + select_passenger_list);
        if (select_passenger_list != null){
            select_passenger_list = JSON.parse(select_passenger_list);
        }
        //传递一个有数据的数组进去
        document.getElementById('passenger-list').innerHTML = doT.template( template )( select_passenger_list );
    });

    //获取app传递过来的参数
    function getParams() {
        alert(param + "==" + "===" + param.user_id);
        console.log(param);
    }

    //删除选择的乘客
    function remove(index) {
        select_passenger_list.splice(index, 1);
        localStorage.setItem("select_passenger_list", JSON.stringify(select_passenger_list));
        var template=document.getElementById('template_passenger').innerHTML;
        //传递一个有数据的数组进去
        document.getElementById('passenger-list').innerHTML = doT.template( template )( select_passenger_list );
    }
</script>
</html>